{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.232.1"},"children":{"VoiceEmotionStack":{"id":"VoiceEmotionStack","path":"VoiceEmotionStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.232.1"},"children":{"DefaultVPC":{"id":"DefaultVPC","path":"VoiceEmotionStack/DefaultVPC","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.232.1","metadata":[]},"children":{"PublicSubnet1":{"id":"PublicSubnet1","path":"VoiceEmotionStack/DefaultVPC/PublicSubnet1","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.232.1","metadata":[]}},"PublicSubnet2":{"id":"PublicSubnet2","path":"VoiceEmotionStack/DefaultVPC/PublicSubnet2","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.232.1","metadata":[]}},"PublicSubnet3":{"id":"PublicSubnet3","path":"VoiceEmotionStack/DefaultVPC/PublicSubnet3","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.232.1","metadata":[]}}}},"VoiceEmotionSG":{"id":"VoiceEmotionSG","path":"VoiceEmotionStack/VoiceEmotionSG","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.SecurityGroup","version":"2.232.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"VoiceEmotionStack/VoiceEmotionSG/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnSecurityGroup","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::SecurityGroup","aws:cdk:cloudformation:props":{"groupDescription":"Security group for Voice Emotion Detector","securityGroupEgress":[{"cidrIp":"0.0.0.0/0","description":"Allow all outbound traffic by default","ipProtocol":"-1"}],"securityGroupIngress":[{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":22,"toPort":22,"description":"SSH access"},{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":80,"toPort":80,"description":"HTTP access"},{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":443,"toPort":443,"description":"HTTPS access"},{"cidrIp":"0.0.0.0/0","ipProtocol":"tcp","fromPort":8501,"toPort":8501,"description":"Streamlit access"}],"tags":[{"key":"CostCenter","value":"Personal"},{"key":"Environment","value":"Production"},{"key":"Project","value":"VoiceEmotionDetector"}],"vpcId":"vpc-0a5e0942b3ffe85df"}}}}},"VoiceEmotionRole":{"id":"VoiceEmotionRole","path":"VoiceEmotionStack/VoiceEmotionRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.232.1","metadata":[]},"children":{"ImportVoiceEmotionRole":{"id":"ImportVoiceEmotionRole","path":"VoiceEmotionStack/VoiceEmotionRole/ImportVoiceEmotionRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.232.1","metadata":[]}},"Resource":{"id":"Resource","path":"VoiceEmotionStack/VoiceEmotionRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"ec2.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/AmazonSSMManagedInstanceCore"]]}],"tags":[{"key":"CostCenter","value":"Personal"},{"key":"Environment","value":"Production"},{"key":"Project","value":"VoiceEmotionDetector"}]}}}}},"VoiceEmotionLT":{"id":"VoiceEmotionLT","path":"VoiceEmotionStack/VoiceEmotionLT","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.LaunchTemplate","version":"2.232.1","metadata":[]},"children":{"Profile":{"id":"Profile","path":"VoiceEmotionStack/VoiceEmotionLT/Profile","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnInstanceProfile","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::InstanceProfile","aws:cdk:cloudformation:props":{"roles":[{"Ref":"VoiceEmotionRole4F2498A4"}]}}},"Resource":{"id":"Resource","path":"VoiceEmotionStack/VoiceEmotionLT/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnLaunchTemplate","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::LaunchTemplate","aws:cdk:cloudformation:props":{"launchTemplateData":{"blockDeviceMappings":[{"deviceName":"/dev/xvda","ebs":{"encrypted":true,"volumeSize":20,"volumeType":"gp3"}}],"iamInstanceProfile":{"arn":{"Fn::GetAtt":["VoiceEmotionLTProfileAF6F9F81","Arn"]}},"imageId":{"Ref":"SsmParameterValueawsserviceamiamazonlinuxlatestal2023amikernel61x8664C96584B6F00A464EAD1953AFF4B05118Parameter"},"instanceType":"t3.medium","instanceMarketOptions":{"marketType":"spot","spotOptions":{"instanceInterruptionBehavior":"stop","maxPrice":"0.05","spotInstanceType":"persistent"}},"securityGroupIds":[{"Fn::GetAtt":["VoiceEmotionSGFBDCFD7B","GroupId"]}],"tagSpecifications":[{"resourceType":"instance","tags":[{"key":"CostCenter","value":"Personal"},{"key":"Environment","value":"Production"},{"key":"Name","value":"VoiceEmotionStack/VoiceEmotionLT"},{"key":"Project","value":"VoiceEmotionDetector"}]},{"resourceType":"volume","tags":[{"key":"CostCenter","value":"Personal"},{"key":"Environment","value":"Production"},{"key":"Name","value":"VoiceEmotionStack/VoiceEmotionLT"},{"key":"Project","value":"VoiceEmotionDetector"}]}],"userData":{"Fn::Base64":"#!/bin/bash\n#!/bin/bash\nset -e\nyum update -y\nyum install -y git docker python3.11 python3.11-pip\ncurl -LsSf https://astral.sh/uv/install.sh | sh\nexport PATH=\"$HOME/.local/bin:$PATH\"\necho 'export PATH=\"$HOME/.local/bin:$PATH\"' >> /etc/profile.d/uv.sh\ndd if=/dev/zero of=/swapfile bs=1M count=4096\nchmod 600 /swapfile\nmkswap /swapfile\nswapon /swapfile\necho \"/swapfile swap swap defaults 0 0\" >> /etc/fstab\ncd /home/ec2-user\ngit clone https://github.com/manishmitra017/voice_guard_rail.git\ncd voice_guard_rail\nchown -R ec2-user:ec2-user /home/ec2-user/voice_guard_rail\nsudo -u ec2-user /root/.local/bin/uv sync\ncat > /etc/systemd/system/voice-emotion.service << 'EOF'\n[Unit]\nDescription=Voice Emotion Detector Streamlit App\nAfter=network.target\n\n[Service]\nType=simple\nUser=ec2-user\nWorkingDirectory=/home/ec2-user/voice_guard_rail\nEnvironment=\"PATH=/home/ec2-user/.local/bin:/usr/local/bin:/usr/bin:/bin\"\nExecStart=/home/ec2-user/.local/bin/uv run streamlit run app.py --server.port 8501 --server.address 0.0.0.0 --server.headless true\nRestart=always\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\nEOF\nsystemctl daemon-reload\nsystemctl enable voice-emotion\nsystemctl start voice-emotion\namazon-linux-extras install nginx1 -y || yum install nginx -y\ncat > /etc/nginx/conf.d/voice-emotion.conf << 'EOF'\nserver {\n    listen 80;\n    server_name _;\n\n    location / {\n        proxy_pass http://localhost:8501;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_read_timeout 86400;\n    }\n}\nEOF\nsystemctl enable nginx\nsystemctl start nginx"}},"tagSpecifications":[{"resourceType":"launch-template","tags":[{"key":"CostCenter","value":"Personal"},{"key":"Environment","value":"Production"},{"key":"Name","value":"VoiceEmotionStack/VoiceEmotionLT"},{"key":"Project","value":"VoiceEmotionDetector"}]}]}}}}},"SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter":{"id":"SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","path":"VoiceEmotionStack/SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118.Parameter","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.232.1"}},"SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118":{"id":"SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118","path":"VoiceEmotionStack/SsmParameterValue:--aws--service--ami-amazon-linux-latest--al2023-ami-kernel-6.1-x86_64:C96584B6-F00A-464E-AD19-53AFF4B05118","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.232.1","metadata":[]}},"VoiceEmotionASG":{"id":"VoiceEmotionASG","path":"VoiceEmotionStack/VoiceEmotionASG","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.AutoScalingGroup","version":"2.232.1","metadata":[]},"children":{"ASG":{"id":"ASG","path":"VoiceEmotionStack/VoiceEmotionASG/ASG","constructInfo":{"fqn":"aws-cdk-lib.aws_autoscaling.CfnAutoScalingGroup","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::AutoScaling::AutoScalingGroup","aws:cdk:cloudformation:props":{"desiredCapacity":"1","healthCheckGracePeriod":600,"healthCheckType":"EC2","launchTemplate":{"launchTemplateId":{"Ref":"VoiceEmotionLT3311603A"},"version":{"Fn::GetAtt":["VoiceEmotionLT3311603A","LatestVersionNumber"]}},"maxSize":"1","minSize":"1","tags":[{"key":"CostCenter","value":"Personal","propagateAtLaunch":true},{"key":"Environment","value":"Production","propagateAtLaunch":true},{"key":"Project","value":"VoiceEmotionDetector","propagateAtLaunch":true}],"vpcZoneIdentifier":["subnet-05c6b2b51e1a3beea","subnet-0482e0374b7e32230","subnet-080d6e84408470cdf"]}}}}},"VoiceEmotionEIP":{"id":"VoiceEmotionEIP","path":"VoiceEmotionStack/VoiceEmotionEIP","constructInfo":{"fqn":"aws-cdk-lib.aws_ec2.CfnEIP","version":"2.232.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::EC2::EIP","aws:cdk:cloudformation:props":{"domain":"vpc","tags":[{"key":"CostCenter","value":"Personal"},{"key":"Environment","value":"Production"},{"key":"Name","value":"VoiceEmotionDetector"},{"key":"Project","value":"VoiceEmotionDetector"}]}}},"ElasticIP":{"id":"ElasticIP","path":"VoiceEmotionStack/ElasticIP","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"AppURL":{"id":"AppURL","path":"VoiceEmotionStack/AppURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"StreamlitURL":{"id":"StreamlitURL","path":"VoiceEmotionStack/StreamlitURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"InstanceType":{"id":"InstanceType","path":"VoiceEmotionStack/InstanceType","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"SpotInstance":{"id":"SpotInstance","path":"VoiceEmotionStack/SpotInstance","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"EstimatedMonthlyCost":{"id":"EstimatedMonthlyCost","path":"VoiceEmotionStack/EstimatedMonthlyCost","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"SSHCommand":{"id":"SSHCommand","path":"VoiceEmotionStack/SSHCommand","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"LogsCommand":{"id":"LogsCommand","path":"VoiceEmotionStack/LogsCommand","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.232.1"}},"CDKMetadata":{"id":"CDKMetadata","path":"VoiceEmotionStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"},"children":{"Default":{"id":"Default","path":"VoiceEmotionStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.232.1"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"VoiceEmotionStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.232.1"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"VoiceEmotionStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.232.1"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.3"}}}}}